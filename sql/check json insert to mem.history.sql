-- check json insert to mem.history
-- ts=1537225280

USE [Arbitron]
GO
/*
SELECT top 10
	   [rownum]
      ,[insert_date]
      ,[dt]
	  ,exchange
	  ,pair
      ,[price]
      ,[amount]
      --,[id_type]
      ,iif([is_buy]=1, 'buy', 'sell') [type]
      ,[id]
  FROM [mem].[history] h with(snapshot)
  inner join mem.exchanges_pairs p on p.id_ex_pair=h.id_ex_pair
  where pair='ETH/USDT' 
	-- and exchange = 'binance' 
order by dt desc --, insert_date desc , rownum desc

select * from dbo.v_last_ts where pair='ETH/USDT' and exchange = 'binance'  order by ts desc

select * from mem.orderbook
where insert_date=(select max(insert_date)insert_date from mem.orderbook) -- 2018-09-18 20:26:25.8100000
*/
--declare @json as varchar(max)='{"exchange": "binance", "pair": "ETH/USDT", "histories": [{"timestamp": 1537295872765, "datetime": "2018-09-18T18:37:52.765Z", "symbol": "ETH/USDT", "id": "36258296", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.1, "cost": 210.1, "amount": 1.0, "fee": null}, {"timestamp": 1537295873224, "datetime": "2018-09-18T18:37:53.224Z", "symbol": "ETH/USDT", "id": "36258297", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.07, "cost": 61.35094349999999, "amount": 0.29205, "fee": null}, {"timestamp": 1537295875015, "datetime": "2018-09-18T18:37:55.015Z", "symbol": "ETH/USDT", "id": "36258298", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.07, "cost": 210.07, "amount": 1.0, "fee": null}, {"timestamp": 1537295876270, "datetime": "2018-09-18T18:37:56.270Z", "symbol": "ETH/USDT", "id": "36258299", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.2, "cost": 699.9996319999999, "amount": 3.33016, "fee": null}, {"timestamp": 1537295876274, "datetime": "2018-09-18T18:37:56.274Z", "symbol": "ETH/USDT", "id": "36258300", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.27, "cost": 279.6591, "amount": 1.33, "fee": null}, {"timestamp": 1537295876274, "datetime": "2018-09-18T18:37:56.274Z", "symbol": "ETH/USDT", "id": "36258301", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.39, "cost": 2244.8613, "amount": 10.67, "fee": null}, {"timestamp": 1537295876294, "datetime": "2018-09-18T18:37:56.294Z", "symbol": "ETH/USDT", "id": "36258302", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.39, "cost": 1962.9387, "amount": 9.33, "fee": null}, {"timestamp": 1537295876475, "datetime": "2018-09-18T18:37:56.475Z", "symbol": "ETH/USDT", "id": "36258303", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.1, "cost": 69.78471499999999, "amount": 0.33215, "fee": null}, {"timestamp": 1537295876509, "datetime": "2018-09-18T18:37:56.509Z", "symbol": "ETH/USDT", "id": "36258304", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.38, "cost": 912.3612574, "amount": 4.33673, "fee": null}, {"timestamp": 1537295877315, "datetime": "2018-09-18T18:37:57.315Z", "symbol": "ETH/USDT", "id": "36258305", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.1, "cost": 84.04, "amount": 0.4, "fee": null}, {"timestamp": 1537295877935, "datetime": "2018-09-18T18:37:57.935Z", "symbol": "ETH/USDT", "id": "36258306", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.1, "cost": 39.919, "amount": 0.19, "fee": null}, {"timestamp": 1537295878636, "datetime": "2018-09-18T18:37:58.636Z", "symbol": "ETH/USDT", "id": "36258307", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.38, "cost": 4838.74, "amount": 23.0, "fee": null}, {"timestamp": 1537295878652, "datetime": "2018-09-18T18:37:58.652Z", "symbol": "ETH/USDT", "id": "36258308", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.38, "cost": 1114.624797, "amount": 5.29815, "fee": null}, {"timestamp": 1537295878673, "datetime": "2018-09-18T18:37:58.673Z", "symbol": "ETH/USDT", "id": "36258309", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.4, "cost": 4208.0, "amount": 20.0, "fee": null}, {"timestamp": 1537295878683, "datetime": "2018-09-18T18:37:58.683Z", "symbol": "ETH/USDT", "id": "36258310", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.37, "cost": 124.11829999999999, "amount": 0.59, "fee": null}, {"timestamp": 1537295879392, "datetime": "2018-09-18T18:37:59.392Z", "symbol": "ETH/USDT", "id": "36258311", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.1, "cost": 165.964293, "amount": 0.78993, "fee": null}, {"timestamp": 1537295879508, "datetime": "2018-09-18T18:37:59.508Z", "symbol": "ETH/USDT", "id": "36258312", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.36, "cost": 166.16967480000002, "amount": 0.78993, "fee": null}, {"timestamp": 1537295879508, "datetime": "2018-09-18T18:37:59.508Z", "symbol": "ETH/USDT", "id": "36258313", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.37, "cost": 4207.4, "amount": 20.0, "fee": null}, {"timestamp": 1537295879892, "datetime": "2018-09-18T18:37:59.892Z", "symbol": "ETH/USDT", "id": "36258314", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.38, "cost": 336.608, "amount": 1.6, "fee": null}, {"timestamp": 1537295879919, "datetime": "2018-09-18T18:37:59.919Z", "symbol": "ETH/USDT", "id": "36258315", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.38, "cost": 20.4531436, "amount": 0.09722, "fee": null}, {"timestamp": 1537295879934, "datetime": "2018-09-18T18:37:59.934Z", "symbol": "ETH/USDT", "id": "36258316", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.38, "cost": 707.29756, "amount": 3.362, "fee": null}, {"timestamp": 1537295880425, "datetime": "2018-09-18T18:38:00.425Z", "symbol": "ETH/USDT", "id": "36258317", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.39, "cost": 4126.5158235, "amount": 19.61365, "fee": null}, {"timestamp": 1537295880425, "datetime": "2018-09-18T18:38:00.425Z", "symbol": "ETH/USDT", "id": "36258318", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.4, "cost": 712.4880400000001, "amount": 3.38635, "fee": null}, {"timestamp": 1537295881860, "datetime": "2018-09-18T18:38:01.860Z", "symbol": "ETH/USDT", "id": "36258319", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.1, "cost": 219.3444, "amount": 1.044, "fee": null}, {"timestamp": 1537295881922, "datetime": "2018-09-18T18:38:01.922Z", "symbol": "ETH/USDT", "id": "36258320", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.1, "cost": 6443.193426999999, "amount": 30.66727, "fee": null}, {"timestamp": 1537295881986, "datetime": "2018-09-18T18:38:01.986Z", "symbol": "ETH/USDT", "id": "36258321", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.06, "cost": 4303.0286856, "amount": 20.48476, "fee": null}, {"timestamp": 1537295881986, "datetime": "2018-09-18T18:38:01.986Z", "symbol": "ETH/USDT", "id": "36258322", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.33, "cost": 219.58452000000003, "amount": 1.044, "fee": null}, {"timestamp": 1537295881986, "datetime": "2018-09-18T18:38:01.986Z", "symbol": "ETH/USDT", "id": "36258323", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.34, "cost": 210.34, "amount": 1.0, "fee": null}, {"timestamp": 1537295881986, "datetime": "2018-09-18T18:38:01.986Z", "symbol": "ETH/USDT", "id": "36258324", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.38, "cost": 253.04506400000002, "amount": 1.2028, "fee": null}, {"timestamp": 1537295881986, "datetime": "2018-09-18T18:38:01.986Z", "symbol": "ETH/USDT", "id": "36258325", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.4, "cost": 2160.479776, "amount": 10.26844, "fee": null}, {"timestamp": 1537295883227, "datetime": "2018-09-18T18:38:03.227Z", "symbol": "ETH/USDT", "id": "36258326", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.05, "cost": 39.9095, "amount": 0.19, "fee": null}, {"timestamp": 1537295883348, "datetime": "2018-09-18T18:38:03.348Z", "symbol": "ETH/USDT", "id": "36258327", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.1, "cost": 105.05, "amount": 0.5, "fee": null}, {"timestamp": 1537295883348, "datetime": "2018-09-18T18:38:03.348Z", "symbol": "ETH/USDT", "id": "36258328", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.39, "cost": 4733.775, "amount": 22.5, "fee": null}, {"timestamp": 1537295885017, "datetime": "2018-09-18T18:38:05.017Z", "symbol": "ETH/USDT", "id": "36258329", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.38, "cost": 5414.160857, "amount": 25.73515, "fee": null}, {"timestamp": 1537295885113, "datetime": "2018-09-18T18:38:05.113Z", "symbol": "ETH/USDT", "id": "36258330", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.4, "cost": 1335.032184, "amount": 6.34521, "fee": null}, {"timestamp": 1537295885113, "datetime": "2018-09-18T18:38:05.113Z", "symbol": "ETH/USDT", "id": "36258331", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.41, "cost": 210.41, "amount": 1.0, "fee": null}, {"timestamp": 1537295885113, "datetime": "2018-09-18T18:38:05.113Z", "symbol": "ETH/USDT", "id": "36258332", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.42, "cost": 21.382880399999998, "amount": 0.10162, "fee": null}, {"timestamp": 1537295885113, "datetime": "2018-09-18T18:38:05.113Z", "symbol": "ETH/USDT", "id": "36258333", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.43, "cost": 14.5470259, "amount": 0.06913, "fee": null}, {"timestamp": 1537295885113, "datetime": "2018-09-18T18:38:05.113Z", "symbol": "ETH/USDT", "id": "36258334", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.48, "cost": 845.5634088, "amount": 4.01731, "fee": null}, {"timestamp": 1537295885113, "datetime": "2018-09-18T18:38:05.113Z", "symbol": "ETH/USDT", "id": "36258335", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.49, "cost": 4729.0219977, "amount": 22.46673, "fee": null}, {"timestamp": 1537295885384, "datetime": "2018-09-18T18:38:05.384Z", "symbol": "ETH/USDT", "id": "36258336", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.07, "cost": 1.1112703000000002, "amount": 0.00529, "fee": null}, {"timestamp": 1537295886248, "datetime": "2018-09-18T18:38:06.248Z", "symbol": "ETH/USDT", "id": "36258337", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.4, "cost": 10.101303999999999, "amount": 0.04801, "fee": null}, {"timestamp": 1537295886935, "datetime": "2018-09-18T18:38:06.935Z", "symbol": "ETH/USDT", "id": "36258338", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.13, "cost": 105.065, "amount": 0.5, "fee": null}, {"timestamp": 1537295887495, "datetime": "2018-09-18T18:38:07.495Z", "symbol": "ETH/USDT", "id": "36258339", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.45, "cost": 106.3382805, "amount": 0.50529, "fee": null}, {"timestamp": 1537295887495, "datetime": "2018-09-18T18:38:07.495Z", "symbol": "ETH/USDT", "id": "36258340", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.46, "cost": 4734.236666600001, "amount": 22.49471, "fee": null}, {"timestamp": 1537295890085, "datetime": "2018-09-18T18:38:10.085Z", "symbol": "ETH/USDT", "id": "36258341", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.42, "cost": 210.42, "amount": 1.0, "fee": null}, {"timestamp": 1537295890085, "datetime": "2018-09-18T18:38:10.085Z", "symbol": "ETH/USDT", "id": "36258342", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.46, "cost": 316.80333340000004, "amount": 1.50529, "fee": null}, {"timestamp": 1537295890085, "datetime": "2018-09-18T18:38:10.085Z", "symbol": "ETH/USDT", "id": "36258343", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.48, "cost": 4209.599999999999, "amount": 20.0, "fee": null}, {"timestamp": 1537295890085, "datetime": "2018-09-18T18:38:10.085Z", "symbol": "ETH/USDT", "id": "36258344", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.49, "cost": 2419.5215079, "amount": 11.49471, "fee": null}, {"timestamp": 1537295891211, "datetime": "2018-09-18T18:38:11.211Z", "symbol": "ETH/USDT", "id": "36258345", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.13, "cost": 105.065, "amount": 0.5, "fee": null}, {"timestamp": 1537295891349, "datetime": "2018-09-18T18:38:11.349Z", "symbol": "ETH/USDT", "id": "36258346", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.13, "cost": 1.1956396999999999, "amount": 0.00569, "fee": null}, {"timestamp": 1537295891659, "datetime": "2018-09-18T18:38:11.659Z", "symbol": "ETH/USDT", "id": "36258347", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.44, "cost": 105.22, "amount": 0.5, "fee": null}, {"timestamp": 1537295891659, "datetime": "2018-09-18T18:38:11.659Z", "symbol": "ETH/USDT", "id": "36258348", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.45, "cost": 4209.0, "amount": 20.0, "fee": null}, {"timestamp": 1537295891659, "datetime": "2018-09-18T18:38:11.659Z", "symbol": "ETH/USDT", "id": "36258349", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.49, "cost": 2841.6150000000002, "amount": 13.5, "fee": null}, {"timestamp": 1537295893266, "datetime": "2018-09-18T18:38:13.266Z", "symbol": "ETH/USDT", "id": "36258350", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.44, "cost": 210.44, "amount": 1.0, "fee": null}, {"timestamp": 1537295893266, "datetime": "2018-09-18T18:38:13.266Z", "symbol": "ETH/USDT", "id": "36258351", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.49, "cost": 3827.3291455000003, "amount": 18.18295, "fee": null}, {"timestamp": 1537295893266, "datetime": "2018-09-18T18:38:13.266Z", "symbol": "ETH/USDT", "id": "36258352", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.5, "cost": 803.489025, "amount": 3.81705, "fee": null}, {"timestamp": 1537295893266, "datetime": "2018-09-18T18:38:13.266Z", "symbol": "ETH/USDT", "id": "36258353", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.5, "cost": 6901.18356, "amount": 32.78472, "fee": null}, {"timestamp": 1537295893266, "datetime": "2018-09-18T18:38:13.266Z", "symbol": "ETH/USDT", "id": "36258354", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.54, "cost": 210.54, "amount": 1.0, "fee": null}, {"timestamp": 1537295893288, "datetime": "2018-09-18T18:38:13.288Z", "symbol": "ETH/USDT", "id": "36258355", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.55, "cost": 1763.5668, "amount": 8.376, "fee": null}, {"timestamp": 1537295893294, "datetime": "2018-09-18T18:38:13.294Z", "symbol": "ETH/USDT", "id": "36258356", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.55, "cost": 213.80510300000003, "amount": 1.01546, "fee": null}, {"timestamp": 1537295893319, "datetime": "2018-09-18T18:38:13.319Z", "symbol": "ETH/USDT", "id": "36258357", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.13, "cost": 1973.4274898, "amount": 9.39146, "fee": null}, {"timestamp": 1537295894469, "datetime": "2018-09-18T18:38:14.469Z", "symbol": "ETH/USDT", "id": "36258358", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.33, "cost": 229.35224520000003, "amount": 1.09044, "fee": null}, {"timestamp": 1537295894469, "datetime": "2018-09-18T18:38:14.469Z", "symbol": "ETH/USDT", "id": "36258359", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.34, "cost": 49.9157854, "amount": 0.23731, "fee": null}, {"timestamp": 1537295894469, "datetime": "2018-09-18T18:38:14.469Z", "symbol": "ETH/USDT", "id": "36258360", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.53, "cost": 1052.65, "amount": 5.0, "fee": null}, {"timestamp": 1537295894469, "datetime": "2018-09-18T18:38:14.469Z", "symbol": "ETH/USDT", "id": "36258361", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.54, "cost": 1982.2530485999998, "amount": 9.41509, "fee": null}, {"timestamp": 1537295894469, "datetime": "2018-09-18T18:38:14.469Z", "symbol": "ETH/USDT", "id": "36258362", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.55, "cost": 500.751065, "amount": 2.3783, "fee": null}, {"timestamp": 1537295894469, "datetime": "2018-09-18T18:38:14.469Z", "symbol": "ETH/USDT", "id": "36258363", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.56, "cost": 3343.4527616, "amount": 15.87886, "fee": null}, {"timestamp": 1537295895526, "datetime": "2018-09-18T18:38:15.526Z", "symbol": "ETH/USDT", "id": "36258364", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.17, "cost": 11.2504001, "amount": 0.05353, "fee": null}, {"timestamp": 1537295896117, "datetime": "2018-09-18T18:38:16.117Z", "symbol": "ETH/USDT", "id": "36258365", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.39, "cost": 11.2621767, "amount": 0.05353, "fee": null}, {"timestamp": 1537295896117, "datetime": "2018-09-18T18:38:16.117Z", "symbol": "ETH/USDT", "id": "36258366", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.4, "cost": 39.976, "amount": 0.19, "fee": null}, {"timestamp": 1537295896117, "datetime": "2018-09-18T18:38:16.117Z", "symbol": "ETH/USDT", "id": "36258367", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.5, "cost": 210.5, "amount": 1.0, "fee": null}, {"timestamp": 1537295896117, "datetime": "2018-09-18T18:38:16.117Z", "symbol": "ETH/USDT", "id": "36258368", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.56, "cost": 9213.3623232, "amount": 43.75647, "fee": null}, {"timestamp": 1537295896844, "datetime": "2018-09-18T18:38:16.844Z", "symbol": "ETH/USDT", "id": "36258369", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.2, "cost": 105.1, "amount": 0.5, "fee": null}, {"timestamp": 1537295897232, "datetime": "2018-09-18T18:38:17.232Z", "symbol": "ETH/USDT", "id": "36258370", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.2, "cost": 334.50176999999996, "amount": 1.59135, "fee": null}, {"timestamp": 1537295897333, "datetime": "2018-09-18T18:38:17.333Z", "symbol": "ETH/USDT", "id": "36258371", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.19, "cost": 210.19, "amount": 1.0, "fee": null}, {"timestamp": 1537295897713, "datetime": "2018-09-18T18:38:17.713Z", "symbol": "ETH/USDT", "id": "36258372", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.46, "cost": 440.14762559999997, "amount": 2.09136, "fee": null}, {"timestamp": 1537295897713, "datetime": "2018-09-18T18:38:17.713Z", "symbol": "ETH/USDT", "id": "36258373", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.47, "cost": 6715.8114608, "amount": 31.90864, "fee": null}, {"timestamp": 1537295898115, "datetime": "2018-09-18T18:38:18.115Z", "symbol": "ETH/USDT", "id": "36258374", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.2, "cost": 19.355216, "amount": 0.09208, "fee": null}, {"timestamp": 1537295898173, "datetime": "2018-09-18T18:38:18.173Z", "symbol": "ETH/USDT", "id": "36258375", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.21, "cost": 439.4545155, "amount": 2.09055, "fee": null}, {"timestamp": 1537295898398, "datetime": "2018-09-18T18:38:18.398Z", "symbol": "ETH/USDT", "id": "36258376", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.14, "cost": 439.30817699999994, "amount": 2.09055, "fee": null}, {"timestamp": 1537295898417, "datetime": "2018-09-18T18:38:18.417Z", "symbol": "ETH/USDT", "id": "36258377", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.13, "cost": 233.2443, "amount": 1.11, "fee": null}, {"timestamp": 1537295898470, "datetime": "2018-09-18T18:38:18.470Z", "symbol": "ETH/USDT", "id": "36258378", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.14, "cost": 439.329191, "amount": 2.09065, "fee": null}, {"timestamp": 1537295898531, "datetime": "2018-09-18T18:38:18.531Z", "symbol": "ETH/USDT", "id": "36258379", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.13, "cost": 439.3082845, "amount": 2.09065, "fee": null}, {"timestamp": 1537295898968, "datetime": "2018-09-18T18:38:18.968Z", "symbol": "ETH/USDT", "id": "36258380", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.46, "cost": 1492.2771530000002, "amount": 7.09055, "fee": null}, {"timestamp": 1537295898968, "datetime": "2018-09-18T18:38:18.968Z", "symbol": "ETH/USDT", "id": "36258381", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.47, "cost": 5242.6919415, "amount": 24.90945, "fee": null}, {"timestamp": 1537295899958, "datetime": "2018-09-18T18:38:19.958Z", "symbol": "ETH/USDT", "id": "36258382", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.17, "cost": 836.8822281, "amount": 3.98193, "fee": null}, {"timestamp": 1537295900011, "datetime": "2018-09-18T18:38:20.011Z", "symbol": "ETH/USDT", "id": "36258383", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.34, "cost": 1319.220929, "amount": 6.27185, "fee": null}, {"timestamp": 1537295900090, "datetime": "2018-09-18T18:38:20.090Z", "symbol": "ETH/USDT", "id": "36258384", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.18, "cost": 519.6027924, "amount": 2.47218, "fee": null}, {"timestamp": 1537295900506, "datetime": "2018-09-18T18:38:20.506Z", "symbol": "ETH/USDT", "id": "36258385", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.35, "cost": 3365.6, "amount": 16.0, "fee": null}, {"timestamp": 1537295900566, "datetime": "2018-09-18T18:38:20.566Z", "symbol": "ETH/USDT", "id": "36258386", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.19, "cost": 105.095, "amount": 0.5, "fee": null}, {"timestamp": 1537295900620, "datetime": "2018-09-18T18:38:20.620Z", "symbol": "ETH/USDT", "id": "36258387", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.19, "cost": 5507.0452608000005, "amount": 26.20032, "fee": null}, {"timestamp": 1537295901008, "datetime": "2018-09-18T18:38:21.008Z", "symbol": "ETH/USDT", "id": "36258388", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.47, "cost": 37.1732114, "amount": 0.17662, "fee": null}, {"timestamp": 1537295901008, "datetime": "2018-09-18T18:38:21.008Z", "symbol": "ETH/USDT", "id": "36258389", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.48, "cost": 1457.3929872, "amount": 6.92414, "fee": null}, {"timestamp": 1537295901008, "datetime": "2018-09-18T18:38:21.008Z", "symbol": "ETH/USDT", "id": "36258390", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.49, "cost": 1069.0302973, "amount": 5.07877, "fee": null}, {"timestamp": 1537295901008, "datetime": "2018-09-18T18:38:21.008Z", "symbol": "ETH/USDT", "id": "36258391", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.52, "cost": 315.78000000000003, "amount": 1.5, "fee": null}, {"timestamp": 1537295901008, "datetime": "2018-09-18T18:38:21.008Z", "symbol": "ETH/USDT", "id": "36258392", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.53, "cost": 3139.6065211, "amount": 14.91287, "fee": null}, {"timestamp": 1537295901008, "datetime": "2018-09-18T18:38:21.008Z", "symbol": "ETH/USDT", "id": "36258393", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.55, "cost": 1349.1201800000001, "amount": 6.4076, "fee": null}, {"timestamp": 1537295901515, "datetime": "2018-09-18T18:38:21.515Z", "symbol": "ETH/USDT", "id": "36258394", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 210.34, "cost": 519.9983412, "amount": 2.47218, "fee": null}, {"timestamp": 1537295901569, "datetime": "2018-09-18T18:38:21.569Z", "symbol": "ETH/USDT", "id": "36258395", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 210.13, "cost": 1483.1164517, "amount": 7.05809, "fee": null}]}'
--declare @json as nvarchar(max) = '{"exchange": "binance", "pair": "ETH/USDT", "histories": [{"timestamp": 1537302953571, "datetime": "2018-09-18T20:35:53.571Z", "symbol": "ETH/USDT", "id": "36266182", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.83, "cost": 301.8834665, "amount": 1.45255, "fee": null}, {"timestamp": 1537302953571, "datetime": "2018-09-18T20:35:53.571Z", "symbol": "ETH/USDT", "id": "36266183", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.88, "cost": 8861.4400396, "amount": 42.62767, "fee": null}, {"timestamp": 1537302953596, "datetime": "2018-09-18T20:35:53.596Z", "symbol": "ETH/USDT", "id": "36266184", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.87, "cost": 301.9415685, "amount": 1.45255, "fee": null}, {"timestamp": 1537302953596, "datetime": "2018-09-18T20:35:53.596Z", "symbol": "ETH/USDT", "id": "36266185", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.88, "cost": 301.956094, "amount": 1.45255, "fee": null}, {"timestamp": 1537302953596, "datetime": "2018-09-18T20:35:53.596Z", "symbol": "ETH/USDT", "id": "36266186", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.9, "cost": 754.664526, "amount": 3.62994, "fee": null}, {"timestamp": 1537302953600, "datetime": "2018-09-18T20:35:53.600Z", "symbol": "ETH/USDT", "id": "36266187", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.9, "cost": 245.33447400000003, "amount": 1.18006, "fee": null}, {"timestamp": 1537302953600, "datetime": "2018-09-18T20:35:53.600Z", "symbol": "ETH/USDT", "id": "36266188", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.91, "cost": 56.6533959, "amount": 0.27249, "fee": null}, {"timestamp": 1537302954398, "datetime": "2018-09-18T20:35:54.398Z", "symbol": "ETH/USDT", "id": "36266189", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.66, "cost": 199.7294646, "amount": 0.96181, "fee": null}, {"timestamp": 1537302954398, "datetime": "2018-09-18T20:35:54.398Z", "symbol": "ETH/USDT", "id": "36266190", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.65, "cost": 476.477843, "amount": 2.29462, "fee": null}, {"timestamp": 1537302954490, "datetime": "2018-09-18T20:35:54.490Z", "symbol": "ETH/USDT", "id": "36266191", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.65, "cost": 11836.390546, "amount": 57.00164, "fee": null}, {"timestamp": 1537302954510, "datetime": "2018-09-18T20:35:54.510Z", "symbol": "ETH/USDT", "id": "36266192", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.9, "cost": 4158.0, "amount": 20.0, "fee": null}, {"timestamp": 1537302954510, "datetime": "2018-09-18T20:35:54.510Z", "symbol": "ETH/USDT", "id": "36266193", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.93, "cost": 2022.680661, "amount": 9.7277, "fee": null}, {"timestamp": 1537302954523, "datetime": "2018-09-18T20:35:54.523Z", "symbol": "ETH/USDT", "id": "36266194", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.93, "cost": 238.56016830000002, "amount": 1.14731, "fee": null}, {"timestamp": 1537302954523, "datetime": "2018-09-18T20:35:54.523Z", "symbol": "ETH/USDT", "id": "36266195", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.94, "cost": 207.94, "amount": 1.0, "fee": null}, {"timestamp": 1537302954622, "datetime": "2018-09-18T20:35:54.622Z", "symbol": "ETH/USDT", "id": "36266196", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.65, "cost": 68.5245, "amount": 0.33, "fee": null}, {"timestamp": 1537302954671, "datetime": "2018-09-18T20:35:54.671Z", "symbol": "ETH/USDT", "id": "36266197", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.65, "cost": 68.5245, "amount": 0.33, "fee": null}, {"timestamp": 1537302954815, "datetime": "2018-09-18T20:35:54.815Z", "symbol": "ETH/USDT", "id": "36266198", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.65, "cost": 41.53, "amount": 0.2, "fee": null}, {"timestamp": 1537302956416, "datetime": "2018-09-18T20:35:56.416Z", "symbol": "ETH/USDT", "id": "36266199", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.8, "cost": 207.8, "amount": 1.0, "fee": null}, {"timestamp": 1537302956833, "datetime": "2018-09-18T20:35:56.833Z", "symbol": "ETH/USDT", "id": "36266200", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.65, "cost": 28.3296895, "amount": 0.13643, "fee": null}, {"timestamp": 1537302961198, "datetime": "2018-09-18T20:36:01.198Z", "symbol": "ETH/USDT", "id": "36266201", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.69, "cost": 71.59697369999999, "amount": 0.34473, "fee": null}, {"timestamp": 1537302964561, "datetime": "2018-09-18T20:36:04.561Z", "symbol": "ETH/USDT", "id": "36266202", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.69, "cost": 6372.7059606, "amount": 30.68374, "fee": null}, {"timestamp": 1537302964591, "datetime": "2018-09-18T20:36:04.591Z", "symbol": "ETH/USDT", "id": "36266203", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.7, "cost": 207.7, "amount": 1.0, "fee": null}, {"timestamp": 1537302964612, "datetime": "2018-09-18T20:36:04.612Z", "symbol": "ETH/USDT", "id": "36266204", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.7, "cost": 207.7, "amount": 1.0, "fee": null}, {"timestamp": 1537302964641, "datetime": "2018-09-18T20:36:04.641Z", "symbol": "ETH/USDT", "id": "36266205", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.7, "cost": 29.078, "amount": 0.14, "fee": null}, {"timestamp": 1537302964641, "datetime": "2018-09-18T20:36:04.641Z", "symbol": "ETH/USDT", "id": "36266206", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.69, "cost": 199.922394, "amount": 0.9626, "fee": null}, {"timestamp": 1537302964641, "datetime": "2018-09-18T20:36:04.641Z", "symbol": "ETH/USDT", "id": "36266207", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.68, "cost": 7.767232000000001, "amount": 0.0374, "fee": null}, {"timestamp": 1537302964664, "datetime": "2018-09-18T20:36:04.664Z", "symbol": "ETH/USDT", "id": "36266208", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.68, "cost": 199.912768, "amount": 0.9626, "fee": null}, {"timestamp": 1537302965079, "datetime": "2018-09-18T20:36:05.079Z", "symbol": "ETH/USDT", "id": "36266209", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.66, "cost": 199.893516, "amount": 0.9626, "fee": null}, {"timestamp": 1537302965566, "datetime": "2018-09-18T20:36:05.566Z", "symbol": "ETH/USDT", "id": "36266210", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.66, "cost": 199.893516, "amount": 0.9626, "fee": null}, {"timestamp": 1537302965566, "datetime": "2018-09-18T20:36:05.566Z", "symbol": "ETH/USDT", "id": "36266211", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.65, "cost": 231.189204, "amount": 1.11336, "fee": null}, {"timestamp": 1537302966286, "datetime": "2018-09-18T20:36:06.286Z", "symbol": "ETH/USDT", "id": "36266212", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.57, "cost": 419.3080056, "amount": 2.02008, "fee": null}, {"timestamp": 1537302966286, "datetime": "2018-09-18T20:36:06.286Z", "symbol": "ETH/USDT", "id": "36266213", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.56, "cost": 5963.6678856, "amount": 28.73226, "fee": null}, {"timestamp": 1537302966309, "datetime": "2018-09-18T20:36:06.309Z", "symbol": "ETH/USDT", "id": "36266214", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.56, "cost": 470.6921144, "amount": 2.26774, "fee": null}, {"timestamp": 1537302966329, "datetime": "2018-09-18T20:36:06.329Z", "symbol": "ETH/USDT", "id": "36266215", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.54, "cost": 59.4436068, "amount": 0.28642, "fee": null}, {"timestamp": 1537302967509, "datetime": "2018-09-18T20:36:07.509Z", "symbol": "ETH/USDT", "id": "36266216", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.52, "cost": 1964.0377616, "amount": 9.46433, "fee": null}, {"timestamp": 1537302967553, "datetime": "2018-09-18T20:36:07.553Z", "symbol": "ETH/USDT", "id": "36266217", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.51, "cost": 207.51, "amount": 1.0, "fee": null}, {"timestamp": 1537302967612, "datetime": "2018-09-18T20:36:07.612Z", "symbol": "ETH/USDT", "id": "36266218", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.52, "cost": 261.4980272, "amount": 1.26011, "fee": null}, {"timestamp": 1537302967669, "datetime": "2018-09-18T20:36:07.669Z", "symbol": "ETH/USDT", "id": "36266219", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.51, "cost": 99.9347409, "amount": 0.48159, "fee": null}, {"timestamp": 1537302967694, "datetime": "2018-09-18T20:36:07.694Z", "symbol": "ETH/USDT", "id": "36266220", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.51, "cost": 99.9347409, "amount": 0.48159, "fee": null}, {"timestamp": 1537302967728, "datetime": "2018-09-18T20:36:07.728Z", "symbol": "ETH/USDT", "id": "36266221", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.51, "cost": 61.7051736, "amount": 0.29736, "fee": null}, {"timestamp": 1537302968212, "datetime": "2018-09-18T20:36:08.212Z", "symbol": "ETH/USDT", "id": "36266222", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.66, "cost": 2071.1364654, "amount": 9.97369, "fee": null}, {"timestamp": 1537302968283, "datetime": "2018-09-18T20:36:08.283Z", "symbol": "ETH/USDT", "id": "36266223", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.77, "cost": 410.3291284, "amount": 1.97492, "fee": null}, {"timestamp": 1537302968405, "datetime": "2018-09-18T20:36:08.405Z", "symbol": "ETH/USDT", "id": "36266224", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.51, "cost": 199.749126, "amount": 0.9626, "fee": null}, {"timestamp": 1537302968463, "datetime": "2018-09-18T20:36:08.463Z", "symbol": "ETH/USDT", "id": "36266225", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.5, "cost": 29.382, "amount": 0.1416, "fee": null}, {"timestamp": 1537302970393, "datetime": "2018-09-18T20:36:10.393Z", "symbol": "ETH/USDT", "id": "36266226", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.64, "cost": 12.528997599999999, "amount": 0.06034, "fee": null}, {"timestamp": 1537302976586, "datetime": "2018-09-18T20:36:16.586Z", "symbol": "ETH/USDT", "id": "36266227", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.5, "cost": 59.552499999999995, "amount": 0.287, "fee": null}, {"timestamp": 1537302976885, "datetime": "2018-09-18T20:36:16.885Z", "symbol": "ETH/USDT", "id": "36266228", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.62, "cost": 136.15719600000003, "amount": 0.6558, "fee": null}, {"timestamp": 1537302977251, "datetime": "2018-09-18T20:36:17.251Z", "symbol": "ETH/USDT", "id": "36266229", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.62, "cost": 410.87998000000005, "amount": 1.979, "fee": null}, {"timestamp": 1537302979079, "datetime": "2018-09-18T20:36:19.079Z", "symbol": "ETH/USDT", "id": "36266230", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.62, "cost": 309.97666000000004, "amount": 1.493, "fee": null}, {"timestamp": 1537302979373, "datetime": "2018-09-18T20:36:19.373Z", "symbol": "ETH/USDT", "id": "36266231", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.62, "cost": 0.2346106, "amount": 0.00113, "fee": null}, {"timestamp": 1537302982902, "datetime": "2018-09-18T20:36:22.902Z", "symbol": "ETH/USDT", "id": "36266232", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.7, "cost": 119.24264699999999, "amount": 0.57411, "fee": null}, {"timestamp": 1537302983257, "datetime": "2018-09-18T20:36:23.257Z", "symbol": "ETH/USDT", "id": "36266233", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.7, "cost": 39.311378999999995, "amount": 0.18927, "fee": null}, {"timestamp": 1537302984772, "datetime": "2018-09-18T20:36:24.772Z", "symbol": "ETH/USDT", "id": "36266234", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.63, "cost": 4793.5288944, "amount": 23.08688, "fee": null}, {"timestamp": 1537302985487, "datetime": "2018-09-18T20:36:25.487Z", "symbol": "ETH/USDT", "id": "36266235", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.63, "cost": 5587.9711056, "amount": 26.91312, "fee": null}, {"timestamp": 1537302996309, "datetime": "2018-09-18T20:36:36.309Z", "symbol": "ETH/USDT", "id": "36266236", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.61, "cost": 199.91182120000002, "amount": 0.96292, "fee": null}, {"timestamp": 1537302996309, "datetime": "2018-09-18T20:36:36.309Z", "symbol": "ETH/USDT", "id": "36266237", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.6, "cost": 554.829684, "amount": 2.67259, "fee": null}, {"timestamp": 1537303003155, "datetime": "2018-09-18T20:36:43.155Z", "symbol": "ETH/USDT", "id": "36266238", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.61, "cost": 48.16552000000001, "amount": 0.232, "fee": null}, {"timestamp": 1537303005322, "datetime": "2018-09-18T20:36:45.322Z", "symbol": "ETH/USDT", "id": "36266239", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.7, "cost": 41.380070999999994, "amount": 0.19923, "fee": null}, {"timestamp": 1537303005322, "datetime": "2018-09-18T20:36:45.322Z", "symbol": "ETH/USDT", "id": "36266240", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.72, "cost": 487.4627556, "amount": 2.34673, "fee": null}, {"timestamp": 1537303005322, "datetime": "2018-09-18T20:36:45.322Z", "symbol": "ETH/USDT", "id": "36266241", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.81, "cost": 2634.0499368, "amount": 12.67528, "fee": null}, {"timestamp": 1537303017381, "datetime": "2018-09-18T20:36:57.381Z", "symbol": "ETH/USDT", "id": "36266242", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.78, "cost": 418.98837000000003, "amount": 2.0165, "fee": null}, {"timestamp": 1537303021986, "datetime": "2018-09-18T20:37:01.986Z", "symbol": "ETH/USDT", "id": "36266243", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.63, "cost": 64.3653, "amount": 0.31, "fee": null}, {"timestamp": 1537303026622, "datetime": "2018-09-18T20:37:06.622Z", "symbol": "ETH/USDT", "id": "36266244", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.65, "cost": 199.87350750000002, "amount": 0.96255, "fee": null}, {"timestamp": 1537303026622, "datetime": "2018-09-18T20:37:06.622Z", "symbol": "ETH/USDT", "id": "36266245", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.64, "cost": 0.36336999999999997, "amount": 0.00175, "fee": null}, {"timestamp": 1537303028097, "datetime": "2018-09-18T20:37:08.097Z", "symbol": "ETH/USDT", "id": "36266246", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.65, "cost": 199.87350750000002, "amount": 0.96255, "fee": null}, {"timestamp": 1537303028097, "datetime": "2018-09-18T20:37:08.097Z", "symbol": "ETH/USDT", "id": "36266247", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.62, "cost": 228.5605532, "amount": 1.10086, "fee": null}, {"timestamp": 1537303028097, "datetime": "2018-09-18T20:37:08.097Z", "symbol": "ETH/USDT", "id": "36266248", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.6, "cost": 582.4031160000001, "amount": 2.80541, "fee": null}, {"timestamp": 1537303028234, "datetime": "2018-09-18T20:37:08.234Z", "symbol": "ETH/USDT", "id": "36266249", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.6, "cost": 355.6188, "amount": 1.713, "fee": null}, {"timestamp": 1537303029164, "datetime": "2018-09-18T20:37:09.164Z", "symbol": "ETH/USDT", "id": "36266250", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.6, "cost": 151.753524, "amount": 0.73099, "fee": null}, {"timestamp": 1537303030049, "datetime": "2018-09-18T20:37:10.049Z", "symbol": "ETH/USDT", "id": "36266251", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.6, "cost": 557.84196, "amount": 2.6871, "fee": null}, {"timestamp": 1537303034691, "datetime": "2018-09-18T20:37:14.691Z", "symbol": "ETH/USDT", "id": "36266252", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.6, "cost": 0.018684, "amount": 9e-05, "fee": null}, {"timestamp": 1537303034691, "datetime": "2018-09-18T20:37:14.691Z", "symbol": "ETH/USDT", "id": "36266253", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.65, "cost": 103.825, "amount": 0.5, "fee": null}, {"timestamp": 1537303034691, "datetime": "2018-09-18T20:37:14.691Z", "symbol": "ETH/USDT", "id": "36266254", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.74, "cost": 480.74152100000003, "amount": 2.31415, "fee": null}, {"timestamp": 1537303034691, "datetime": "2018-09-18T20:37:14.691Z", "symbol": "ETH/USDT", "id": "36266255", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.78, "cost": 29.353080600000002, "amount": 0.14127, "fee": null}, {"timestamp": 1537303034691, "datetime": "2018-09-18T20:37:14.691Z", "symbol": "ETH/USDT", "id": "36266256", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.83, "cost": 207.83, "amount": 1.0, "fee": null}, {"timestamp": 1537303034691, "datetime": "2018-09-18T20:37:14.691Z", "symbol": "ETH/USDT", "id": "36266257", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.87, "cost": 297.7696176, "amount": 1.43248, "fee": null}, {"timestamp": 1537303034691, "datetime": "2018-09-18T20:37:14.691Z", "symbol": "ETH/USDT", "id": "36266258", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.88, "cost": 250.51826679999996, "amount": 1.20511, "fee": null}, {"timestamp": 1537303034691, "datetime": "2018-09-18T20:37:14.691Z", "symbol": "ETH/USDT", "id": "36266259", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.89, "cost": 1156.5648314999999, "amount": 5.56335, "fee": null}, {"timestamp": 1537303034714, "datetime": "2018-09-18T20:37:14.714Z", "symbol": "ETH/USDT", "id": "36266260", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.89, "cost": 4611.395191, "amount": 22.1819, "fee": null}, {"timestamp": 1537303038105, "datetime": "2018-09-18T20:37:18.105Z", "symbol": "ETH/USDT", "id": "36266261", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.64, "cost": 41.528, "amount": 0.2, "fee": null}, {"timestamp": 1537303042295, "datetime": "2018-09-18T20:37:22.295Z", "symbol": "ETH/USDT", "id": "36266262", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.64, "cost": 158.25905519999998, "amount": 0.76218, "fee": null}, {"timestamp": 1537303043027, "datetime": "2018-09-18T20:37:23.027Z", "symbol": "ETH/USDT", "id": "36266263", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.59, "cost": 114.2616878, "amount": 0.55042, "fee": null}, {"timestamp": 1537303043066, "datetime": "2018-09-18T20:37:23.066Z", "symbol": "ETH/USDT", "id": "36266264", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.56, "cost": 106.27072, "amount": 0.512, "fee": null}, {"timestamp": 1537303043708, "datetime": "2018-09-18T20:37:23.708Z", "symbol": "ETH/USDT", "id": "36266265", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.56, "cost": 17.90205, "amount": 0.08625, "fee": null}, {"timestamp": 1537303043752, "datetime": "2018-09-18T20:37:23.752Z", "symbol": "ETH/USDT", "id": "36266266", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.56, "cost": 778.35, "amount": 3.75, "fee": null}, {"timestamp": 1537303047849, "datetime": "2018-09-18T20:37:27.849Z", "symbol": "ETH/USDT", "id": "36266267", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.65, "cost": 29.7873925, "amount": 0.14345, "fee": null}, {"timestamp": 1537303048570, "datetime": "2018-09-18T20:37:28.570Z", "symbol": "ETH/USDT", "id": "36266268", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.65, "cost": 12.519218500000001, "amount": 0.06029, "fee": null}, {"timestamp": 1537303053023, "datetime": "2018-09-18T20:37:33.023Z", "symbol": "ETH/USDT", "id": "36266269", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.65, "cost": 100.00424, "amount": 0.4816, "fee": null}, {"timestamp": 1537303065928, "datetime": "2018-09-18T20:37:45.928Z", "symbol": "ETH/USDT", "id": "36266270", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.61, "cost": 33.9587677, "amount": 0.16357, "fee": null}, {"timestamp": 1537303068605, "datetime": "2018-09-18T20:37:48.605Z", "symbol": "ETH/USDT", "id": "36266271", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.6, "cost": 31.7628, "amount": 0.153, "fee": null}, {"timestamp": 1537303068605, "datetime": "2018-09-18T20:37:48.605Z", "symbol": "ETH/USDT", "id": "36266272", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.58, "cost": 7.68046, "amount": 0.037, "fee": null}, {"timestamp": 1537303071159, "datetime": "2018-09-18T20:37:51.159Z", "symbol": "ETH/USDT", "id": "36266273", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.65, "cost": 315.2127, "amount": 1.518, "fee": null}, {"timestamp": 1537303075359, "datetime": "2018-09-18T20:37:55.359Z", "symbol": "ETH/USDT", "id": "36266274", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.58, "cost": 39.440200000000004, "amount": 0.19, "fee": null}, {"timestamp": 1537303083147, "datetime": "2018-09-18T20:38:03.147Z", "symbol": "ETH/USDT", "id": "36266275", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.59, "cost": 848.8998629, "amount": 4.08931, "fee": null}, {"timestamp": 1537303092132, "datetime": "2018-09-18T20:38:12.132Z", "symbol": "ETH/USDT", "id": "36266276", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.59, "cost": 39.4421, "amount": 0.19, "fee": null}, {"timestamp": 1537303093297, "datetime": "2018-09-18T20:38:13.297Z", "symbol": "ETH/USDT", "id": "36266277", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.65, "cost": 6.599117000000001, "amount": 0.03178, "fee": null}, {"timestamp": 1537303096500, "datetime": "2018-09-18T20:38:16.500Z", "symbol": "ETH/USDT", "id": "36266278", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.74, "cost": 199.8853506, "amount": 0.96219, "fee": null}, {"timestamp": 1537303096500, "datetime": "2018-09-18T20:38:16.500Z", "symbol": "ETH/USDT", "id": "36266279", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.75, "cost": 826.9592625, "amount": 3.98055, "fee": null}, {"timestamp": 1537303097517, "datetime": "2018-09-18T20:38:17.517Z", "symbol": "ETH/USDT", "id": "36266280", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 207.83, "cost": 5195.75, "amount": 25.0, "fee": null}, {"timestamp": 1537303098738, "datetime": "2018-09-18T20:38:18.738Z", "symbol": "ETH/USDT", "id": "36266281", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.66, "cost": 39.4554, "amount": 0.19, "fee": null}]}'
declare @json as nvarchar(max) = '{"exchange": "binance", "pair": "ETH/USDT", "histories": [{"timestamp": 1537306225957, "datetime": "2018-09-18T21:30:25.957Z", "symbol": "ETH/USDT", "id": "36268251", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.19, "cost": 4.7987795, "amount": 0.02305, "fee": null}, {"timestamp": 1537306225957, "datetime": "2018-09-18T21:30:25.957Z", "symbol": "ETH/USDT", "id": "36268252", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.15, "cost": 158.0878435, "amount": 0.75949, "fee": null}, {"timestamp": 1537306229260, "datetime": "2018-09-18T21:30:29.260Z", "symbol": "ETH/USDT", "id": "36268253", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.26, "cost": 24.258124799999997, "amount": 0.11648, "fee": null}, {"timestamp": 1537306229260, "datetime": "2018-09-18T21:30:29.260Z", "symbol": "ETH/USDT", "id": "36268254", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.28, "cost": 170.32097, "amount": 0.81775, "fee": null}, {"timestamp": 1537306230536, "datetime": "2018-09-18T21:30:30.536Z", "symbol": "ETH/USDT", "id": "36268255", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.22, "cost": 179.9291486, "amount": 0.86413, "fee": null}, {"timestamp": 1537306230561, "datetime": "2018-09-18T21:30:30.561Z", "symbol": "ETH/USDT", "id": "36268256", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.21, "cost": 1360.1588923000002, "amount": 6.53263, "fee": null}, {"timestamp": 1537306230581, "datetime": "2018-09-18T21:30:30.581Z", "symbol": "ETH/USDT", "id": "36268257", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.21, "cost": 721.9411077, "amount": 3.46737, "fee": null}, {"timestamp": 1537306241128, "datetime": "2018-09-18T21:30:41.128Z", "symbol": "ETH/USDT", "id": "36268258", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.13, "cost": 0.5910892, "amount": 0.00284, "fee": null}, {"timestamp": 1537306243321, "datetime": "2018-09-18T21:30:43.321Z", "symbol": "ETH/USDT", "id": "36268259", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.13, "cost": 26.01625, "amount": 0.125, "fee": null}, {"timestamp": 1537306245200, "datetime": "2018-09-18T21:30:45.200Z", "symbol": "ETH/USDT", "id": "36268260", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.29, "cost": 54.36369, "amount": 0.261, "fee": null}, {"timestamp": 1537306246276, "datetime": "2018-09-18T21:30:46.276Z", "symbol": "ETH/USDT", "id": "36268261", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.29, "cost": 73.52428710000001, "amount": 0.35299, "fee": null}, {"timestamp": 1537306247084, "datetime": "2018-09-18T21:30:47.084Z", "symbol": "ETH/USDT", "id": "36268262", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.29, "cost": 93.10563, "amount": 0.447, "fee": null}, {"timestamp": 1537306247145, "datetime": "2018-09-18T21:30:47.145Z", "symbol": "ETH/USDT", "id": "36268263", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.29, "cost": 35.201010000000004, "amount": 0.169, "fee": null}, {"timestamp": 1537306250642, "datetime": "2018-09-18T21:30:50.642Z", "symbol": "ETH/USDT", "id": "36268264", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.22, "cost": 39.9719934, "amount": 0.19197, "fee": null}, {"timestamp": 1537306267843, "datetime": "2018-09-18T21:31:07.843Z", "symbol": "ETH/USDT", "id": "36268265", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.29, "cost": 52.0725, "amount": 0.25, "fee": null}, {"timestamp": 1537306271572, "datetime": "2018-09-18T21:31:11.572Z", "symbol": "ETH/USDT", "id": "36268266", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.23, "cost": 386.13130049999995, "amount": 1.85435, "fee": null}, {"timestamp": 1537306272217, "datetime": "2018-09-18T21:31:12.217Z", "symbol": "ETH/USDT", "id": "36268267", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.23, "cost": 56.51362199999999, "amount": 0.2714, "fee": null}, {"timestamp": 1537306276252, "datetime": "2018-09-18T21:31:16.252Z", "symbol": "ETH/USDT", "id": "36268268", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.29, "cost": 411.37275, "amount": 1.975, "fee": null}, {"timestamp": 1537306310337, "datetime": "2018-09-18T21:31:50.337Z", "symbol": "ETH/USDT", "id": "36268269", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.28, "cost": 210.3628, "amount": 1.01, "fee": null}, {"timestamp": 1537306314178, "datetime": "2018-09-18T21:31:54.178Z", "symbol": "ETH/USDT", "id": "36268270", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.22, "cost": 20.840739799999998, "amount": 0.10009, "fee": null}, {"timestamp": 1537306316948, "datetime": "2018-09-18T21:31:56.948Z", "symbol": "ETH/USDT", "id": "36268271", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.22, "cost": 20.8782194, "amount": 0.10027, "fee": null}, {"timestamp": 1537306317107, "datetime": "2018-09-18T21:31:57.107Z", "symbol": "ETH/USDT", "id": "36268272", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.22, "cost": 12.982517, "amount": 0.06235, "fee": null}, {"timestamp": 1537306317107, "datetime": "2018-09-18T21:31:57.107Z", "symbol": "ETH/USDT", "id": "36268273", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.2, "cost": 479.2680719999999, "amount": 2.30196, "fee": null}, {"timestamp": 1537306319904, "datetime": "2018-09-18T21:31:59.904Z", "symbol": "ETH/USDT", "id": "36268274", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.21, "cost": 20.8397389, "amount": 0.10009, "fee": null}, {"timestamp": 1537306322589, "datetime": "2018-09-18T21:32:02.589Z", "symbol": "ETH/USDT", "id": "36268275", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.21, "cost": 463.6024681, "amount": 2.22661, "fee": null}, {"timestamp": 1537306325706, "datetime": "2018-09-18T21:32:05.706Z", "symbol": "ETH/USDT", "id": "36268276", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.2, "cost": 193.498998, "amount": 0.92939, "fee": null}, {"timestamp": 1537306332368, "datetime": "2018-09-18T21:32:12.368Z", "symbol": "ETH/USDT", "id": "36268277", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.2, "cost": 29.97039, "amount": 0.14395, "fee": null}, {"timestamp": 1537306346911, "datetime": "2018-09-18T21:32:26.911Z", "symbol": "ETH/USDT", "id": "36268278", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.28, "cost": 208.28, "amount": 1.0, "fee": null}, {"timestamp": 1537306347070, "datetime": "2018-09-18T21:32:27.070Z", "symbol": "ETH/USDT", "id": "36268279", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.22, "cost": 596.5107382, "amount": 2.86481, "fee": null}, {"timestamp": 1537306347070, "datetime": "2018-09-18T21:32:27.070Z", "symbol": "ETH/USDT", "id": "36268280", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.21, "cost": 452.33414289999996, "amount": 2.17249, "fee": null}, {"timestamp": 1537306356985, "datetime": "2018-09-18T21:32:36.985Z", "symbol": "ETH/USDT", "id": "36268281", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.21, "cost": 144.1875071, "amount": 0.69251, "fee": null}, {"timestamp": 1537306356985, "datetime": "2018-09-18T21:32:36.985Z", "symbol": "ETH/USDT", "id": "36268282", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.2, "cost": 121.55340599999998, "amount": 0.58383, "fee": null}, {"timestamp": 1537306359255, "datetime": "2018-09-18T21:32:39.255Z", "symbol": "ETH/USDT", "id": "36268283", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.2, "cost": 24.159527999999998, "amount": 0.11604, "fee": null}, {"timestamp": 1537306364755, "datetime": "2018-09-18T21:32:44.755Z", "symbol": "ETH/USDT", "id": "36268284", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.2, "cost": 2.4151199999999995, "amount": 0.0116, "fee": null}, {"timestamp": 1537306365112, "datetime": "2018-09-18T21:32:45.112Z", "symbol": "ETH/USDT", "id": "36268285", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.26, "cost": 180.1490652, "amount": 0.86502, "fee": null}, {"timestamp": 1537306365112, "datetime": "2018-09-18T21:32:45.112Z", "symbol": "ETH/USDT", "id": "36268286", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.27, "cost": 444.65228460000003, "amount": 2.13498, "fee": null}, {"timestamp": 1537306389467, "datetime": "2018-09-18T21:33:09.467Z", "symbol": "ETH/USDT", "id": "36268287", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.17, "cost": 163.5466788, "amount": 0.78564, "fee": null}, {"timestamp": 1537306391487, "datetime": "2018-09-18T21:33:11.487Z", "symbol": "ETH/USDT", "id": "36268288", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.17, "cost": 16.3579986, "amount": 0.07858, "fee": null}, {"timestamp": 1537306391934, "datetime": "2018-09-18T21:33:11.934Z", "symbol": "ETH/USDT", "id": "36268289", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.15, "cost": 179.92069700000002, "amount": 0.86438, "fee": null}, {"timestamp": 1537306393719, "datetime": "2018-09-18T21:33:13.719Z", "symbol": "ETH/USDT", "id": "36268290", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.14, "cost": 0.5911176, "amount": 0.00284, "fee": null}, {"timestamp": 1537306394796, "datetime": "2018-09-18T21:33:14.796Z", "symbol": "ETH/USDT", "id": "36268291", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.14, "cost": 201.6543576, "amount": 0.96884, "fee": null}, {"timestamp": 1537306396240, "datetime": "2018-09-18T21:33:16.240Z", "symbol": "ETH/USDT", "id": "36268292", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.14, "cost": 18.330889799999998, "amount": 0.08807, "fee": null}, {"timestamp": 1537306403075, "datetime": "2018-09-18T21:33:23.075Z", "symbol": "ETH/USDT", "id": "36268293", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.11, "cost": 14.567700000000002, "amount": 0.07, "fee": null}, {"timestamp": 1537306408320, "datetime": "2018-09-18T21:33:28.320Z", "symbol": "ETH/USDT", "id": "36268294", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.11, "cost": 150.3303396, "amount": 0.72236, "fee": null}, {"timestamp": 1537306410268, "datetime": "2018-09-18T21:33:30.268Z", "symbol": "ETH/USDT", "id": "36268295", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.11, "cost": 13.6624215, "amount": 0.06565, "fee": null}, {"timestamp": 1537306414367, "datetime": "2018-09-18T21:33:34.367Z", "symbol": "ETH/USDT", "id": "36268296", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.11, "cost": 1.3693638000000001, "amount": 0.00658, "fee": null}, {"timestamp": 1537306414367, "datetime": "2018-09-18T21:33:34.367Z", "symbol": "ETH/USDT", "id": "36268297", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.1, "cost": 78.50780599999999, "amount": 0.37726, "fee": null}, {"timestamp": 1537306419356, "datetime": "2018-09-18T21:33:39.356Z", "symbol": "ETH/USDT", "id": "36268298", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.1, "cost": 30.700992999999997, "amount": 0.14753, "fee": null}, {"timestamp": 1537306425893, "datetime": "2018-09-18T21:33:45.893Z", "symbol": "ETH/USDT", "id": "36268299", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.1, "cost": 3.071556, "amount": 0.01476, "fee": null}, {"timestamp": 1537306425893, "datetime": "2018-09-18T21:33:45.893Z", "symbol": "ETH/USDT", "id": "36268300", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 207.94, "cost": 127.68139819999999, "amount": 0.61403, "fee": null}, {"timestamp": 1537306431512, "datetime": "2018-09-18T21:33:51.512Z", "symbol": "ETH/USDT", "id": "36268301", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.09, "cost": 137.75558, "amount": 0.662, "fee": null}, {"timestamp": 1537306443028, "datetime": "2018-09-18T21:34:03.028Z", "symbol": "ETH/USDT", "id": "36268302", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.09, "cost": 25.7282476, "amount": 0.12364, "fee": null}, {"timestamp": 1537306460231, "datetime": "2018-09-18T21:34:20.231Z", "symbol": "ETH/USDT", "id": "36268303", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.09, "cost": 47.1032524, "amount": 0.22636, "fee": null}, {"timestamp": 1537306461090, "datetime": "2018-09-18T21:34:21.090Z", "symbol": "ETH/USDT", "id": "36268304", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.09, "cost": 785.2567476, "amount": 3.77364, "fee": null}, {"timestamp": 1537306467316, "datetime": "2018-09-18T21:34:27.316Z", "symbol": "ETH/USDT", "id": "36268305", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.02, "cost": 193.1299284, "amount": 0.92842, "fee": null}, {"timestamp": 1537306469019, "datetime": "2018-09-18T21:34:29.019Z", "symbol": "ETH/USDT", "id": "36268306", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.09, "cost": 462.875396, "amount": 2.2244, "fee": null}, {"timestamp": 1537306473169, "datetime": "2018-09-18T21:34:33.169Z", "symbol": "ETH/USDT", "id": "36268307", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.1, "cost": 111.1254, "amount": 0.534, "fee": null}, {"timestamp": 1537306480410, "datetime": "2018-09-18T21:34:40.410Z", "symbol": "ETH/USDT", "id": "36268308", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.1, "cost": 0.099888, "amount": 0.00048, "fee": null}, {"timestamp": 1537306483754, "datetime": "2018-09-18T21:34:43.754Z", "symbol": "ETH/USDT", "id": "36268309", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.17, "cost": 19.9093788, "amount": 0.09564, "fee": null}, {"timestamp": 1537306483907, "datetime": "2018-09-18T21:34:43.907Z", "symbol": "ETH/USDT", "id": "36268310", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.11, "cost": 9.976793400000002, "amount": 0.04794, "fee": null}, {"timestamp": 1537306487730, "datetime": "2018-09-18T21:34:47.730Z", "symbol": "ETH/USDT", "id": "36268311", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.11, "cost": 155.52268410000002, "amount": 0.74731, "fee": null}, {"timestamp": 1537306493070, "datetime": "2018-09-18T21:34:53.070Z", "symbol": "ETH/USDT", "id": "36268312", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.17, "cost": 21.231258299999997, "amount": 0.10199, "fee": null}, {"timestamp": 1537306505872, "datetime": "2018-09-18T21:35:05.872Z", "symbol": "ETH/USDT", "id": "36268313", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.17, "cost": 0.28519289999999997, "amount": 0.00137, "fee": null}, {"timestamp": 1537306512227, "datetime": "2018-09-18T21:35:12.227Z", "symbol": "ETH/USDT", "id": "36268314", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.17, "cost": 39.552299999999995, "amount": 0.19, "fee": null}, {"timestamp": 1537306515202, "datetime": "2018-09-18T21:35:15.202Z", "symbol": "ETH/USDT", "id": "36268315", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.17, "cost": 2153.0981466, "amount": 10.34298, "fee": null}, {"timestamp": 1537306519780, "datetime": "2018-09-18T21:35:19.780Z", "symbol": "ETH/USDT", "id": "36268316", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.22, "cost": 0.0458084, "amount": 0.00022, "fee": null}, {"timestamp": 1537306526741, "datetime": "2018-09-18T21:35:26.741Z", "symbol": "ETH/USDT", "id": "36268317", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.11, "cost": 1.0280634, "amount": 0.00494, "fee": null}, {"timestamp": 1537306537296, "datetime": "2018-09-18T21:35:37.296Z", "symbol": "ETH/USDT", "id": "36268318", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.17, "cost": 629.29791, "amount": 3.023, "fee": null}, {"timestamp": 1537306538435, "datetime": "2018-09-18T21:35:38.435Z", "symbol": "ETH/USDT", "id": "36268319", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.17, "cost": 0.0936765, "amount": 0.00045, "fee": null}, {"timestamp": 1537306538435, "datetime": "2018-09-18T21:35:38.435Z", "symbol": "ETH/USDT", "id": "36268320", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.13, "cost": 159.7501815, "amount": 0.76755, "fee": null}, {"timestamp": 1537306552411, "datetime": "2018-09-18T21:35:52.411Z", "symbol": "ETH/USDT", "id": "36268321", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.22, "cost": 1665.76, "amount": 8.0, "fee": null}, {"timestamp": 1537306554102, "datetime": "2018-09-18T21:35:54.102Z", "symbol": "ETH/USDT", "id": "36268322", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.17, "cost": 116.36703, "amount": 0.559, "fee": null}, {"timestamp": 1537306556544, "datetime": "2018-09-18T21:35:56.544Z", "symbol": "ETH/USDT", "id": "36268323", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.17, "cost": 0.20400659999999998, "amount": 0.00098, "fee": null}, {"timestamp": 1537306557485, "datetime": "2018-09-18T21:35:57.485Z", "symbol": "ETH/USDT", "id": "36268324", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.13, "cost": 0.17899179999999998, "amount": 0.00086, "fee": null}, {"timestamp": 1537306557485, "datetime": "2018-09-18T21:35:57.485Z", "symbol": "ETH/USDT", "id": "36268325", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.1, "cost": 2156.361334, "amount": 10.36214, "fee": null}, {"timestamp": 1537306558613, "datetime": "2018-09-18T21:35:58.613Z", "symbol": "ETH/USDT", "id": "36268326", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.11, "cost": 147.34188, "amount": 0.708, "fee": null}, {"timestamp": 1537306566107, "datetime": "2018-09-18T21:36:06.107Z", "symbol": "ETH/USDT", "id": "36268327", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.11, "cost": 12.588573900000002, "amount": 0.06049, "fee": null}, {"timestamp": 1537306566169, "datetime": "2018-09-18T21:36:06.169Z", "symbol": "ETH/USDT", "id": "36268328", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.11, "cost": 404.35773000000006, "amount": 1.943, "fee": null}, {"timestamp": 1537306567516, "datetime": "2018-09-18T21:36:07.516Z", "symbol": "ETH/USDT", "id": "36268329", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.11, "cost": 227.776395, "amount": 1.0945, "fee": null}, {"timestamp": 1537306571909, "datetime": "2018-09-18T21:36:11.909Z", "symbol": "ETH/USDT", "id": "36268330", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.11, "cost": 19.851612900000003, "amount": 0.09539, "fee": null}, {"timestamp": 1537306574836, "datetime": "2018-09-18T21:36:14.836Z", "symbol": "ETH/USDT", "id": "36268331", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.11, "cost": 19.851612900000003, "amount": 0.09539, "fee": null}, {"timestamp": 1537306577701, "datetime": "2018-09-18T21:36:17.701Z", "symbol": "ETH/USDT", "id": "36268332", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.11, "cost": 174.75829140000002, "amount": 0.83974, "fee": null}, {"timestamp": 1537306583196, "datetime": "2018-09-18T21:36:23.196Z", "symbol": "ETH/USDT", "id": "36268333", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.11, "cost": 0.1727313, "amount": 0.00083, "fee": null}, {"timestamp": 1537306596254, "datetime": "2018-09-18T21:36:36.254Z", "symbol": "ETH/USDT", "id": "36268334", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.11, "cost": 501.84061620000006, "amount": 2.41142, "fee": null}, {"timestamp": 1537306596311, "datetime": "2018-09-18T21:36:36.311Z", "symbol": "ETH/USDT", "id": "36268335", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.1, "cost": 15.289106999999998, "amount": 0.07347, "fee": null}, {"timestamp": 1537306597504, "datetime": "2018-09-18T21:36:37.504Z", "symbol": "ETH/USDT", "id": "36268336", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.15, "cost": 3.5385500000000003, "amount": 0.017, "fee": null}, {"timestamp": 1537306599683, "datetime": "2018-09-18T21:36:39.683Z", "symbol": "ETH/USDT", "id": "36268337", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.13, "cost": 157.2401337, "amount": 0.75549, "fee": null}, {"timestamp": 1537306599683, "datetime": "2018-09-18T21:36:39.683Z", "symbol": "ETH/USDT", "id": "36268338", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.14, "cost": 154.9623114, "amount": 0.74451, "fee": null}, {"timestamp": 1537306613104, "datetime": "2018-09-18T21:36:53.104Z", "symbol": "ETH/USDT", "id": "36268339", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.13, "cost": 113.22272000000001, "amount": 0.544, "fee": null}, {"timestamp": 1537306633074, "datetime": "2018-09-18T21:37:13.074Z", "symbol": "ETH/USDT", "id": "36268340", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.06, "cost": 10.6089794, "amount": 0.05099, "fee": null}, {"timestamp": 1537306633625, "datetime": "2018-09-18T21:37:13.625Z", "symbol": "ETH/USDT", "id": "36268341", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.05, "cost": 28.353054000000004, "amount": 0.13628, "fee": null}, {"timestamp": 1537306636602, "datetime": "2018-09-18T21:37:16.602Z", "symbol": "ETH/USDT", "id": "36268342", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.13, "cost": 44.9997873, "amount": 0.21621, "fee": null}, {"timestamp": 1537306664043, "datetime": "2018-09-18T21:37:44.043Z", "symbol": "ETH/USDT", "id": "36268343", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.13, "cost": 15.717977600000001, "amount": 0.07552, "fee": null}, {"timestamp": 1537306673929, "datetime": "2018-09-18T21:37:53.929Z", "symbol": "ETH/USDT", "id": "36268344", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.13, "cost": 27.290005599999997, "amount": 0.13112, "fee": null}, {"timestamp": 1537306683664, "datetime": "2018-09-18T21:38:03.664Z", "symbol": "ETH/USDT", "id": "36268345", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.12, "cost": 25.6757644, "amount": 0.12337, "fee": null}, {"timestamp": 1537306686032, "datetime": "2018-09-18T21:38:06.032Z", "symbol": "ETH/USDT", "id": "36268346", "order": null, "type": null, "takerOrMaker": null, "side": "buy", "price": 208.12, "cost": 29.440655200000002, "amount": 0.14146, "fee": null}, {"timestamp": 1537306688026, "datetime": "2018-09-18T21:38:08.026Z", "symbol": "ETH/USDT", "id": "36268347", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.07, "cost": 159.90595639999998, "amount": 0.76852, "fee": null}, {"timestamp": 1537306688026, "datetime": "2018-09-18T21:38:08.026Z", "symbol": "ETH/USDT", "id": "36268348", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.06, "cost": 282.2292288, "amount": 1.35648, "fee": null}, {"timestamp": 1537306695358, "datetime": "2018-09-18T21:38:15.358Z", "symbol": "ETH/USDT", "id": "36268349", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.08, "cost": 159.930288, "amount": 0.7686, "fee": null}, {"timestamp": 1537306695358, "datetime": "2018-09-18T21:38:15.358Z", "symbol": "ETH/USDT", "id": "36268350", "order": null, "type": null, "takerOrMaker": null, "side": "sell", "price": 208.07, "cost": 36.7805339, "amount": 0.17677, "fee": null}]}'

INSERT INTO mem.history (insert_date, dt, id_ex_pair, price, amount, id_type, is_buy, [id])
select GETUTCDATE() insert_date, dt, ep.id_ex_pair, 
			conv.price, 
			conv.amount, 
			x.id_type,
			x.is_buy,
			cast(coalesce(id1, id2, id3) as decimal(38,0)) [id]

	from  OPENJSON(@json) 
		with (
			exchange varchar(50) '$.exchange',
			pair varchar(10) '$.pair'
		) e
	cross apply OPENJSON(@json,'$.histories')
		with (
			[timestamp] numeric(38, 0) '$.timestamp',
			-- [timestamp] numeric(38, 0) '$.date',
			[type] varchar(24) '$.type',
			--quantity decimal(38, 12) '$.quantity',
			price varchar(32) '$.price',
			amount varchar(32) '$.amount',
			side varchar(5) '$.side',
			[id1] bigint '$.trade_id',
			[id2] bigint '$.id',
			[id3] bigint '$.tid'
		) j
	cross apply (
		select 
			cast((case [type]
					when 'limit' then 1
					when 'market' then 2 else NULL end) as smallint) id_type,
			cast((case [side]
					when 'sell' then 0
					when 'buy' then 1 else NULL end) as bit) is_buy
	) x
	cross apply (SELECT DATEADD(second, [timestamp]/1000, CAST('1970-01-01 00:00:00' AS datetime)) dt) d
	inner join mem.exchanges_pairs ep on e.exchange=ep.exchange and e.pair=ep.pair
	cross apply (
		select
			cast(cast(j.price as real) as decimal(38,10)) price, 
			cast(cast(j.amount as real) as decimal(38,10)) amount
	) conv
	
	where not exists (select 1 from mem.history h where h.id_ex_pair = ep.id_ex_pair --and h.id=coalesce(id1,id2,id3)
			and h.dt = d.dt and h.price=conv.price and h.amount=conv.amount --and h.is_buy=x.is_buy
		)
	
	/*
	select * from mem.history where id_ex_pair=19 and dt='17.09.2018 21:22:33'
	select max(dt) from mem.history where id_ex_pair=19
	*/