-- test mem.save_history_json 1.1 

declare @json varchar(max) = '{"exchange": "exmo", "pair": "EOS/BTC", "histories": [{"id": "69275181", "timestamp": 1536379077000, "datetime": "2018-09-08T03:57:57.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083213, "amount": 13.36, "cost": 0.01111725}, {"id": "69275217", "timestamp": 1536379184000, "datetime": "2018-09-08T03:59:44.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083095, "amount": 14.9, "cost": 0.01238115}, {"id": "69275519", "timestamp": 1536379723000, "datetime": "2018-09-08T04:08:43.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00082964, "amount": 16.4, "cost": 0.01360609}, {"id": "69275593", "timestamp": 1536379822000, "datetime": "2018-09-08T04:10:22.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00082887, "amount": 14.981, "cost": 0.0124173}, {"id": "69275797", "timestamp": 1536380193000, "datetime": "2018-09-08T04:16:33.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083173, "amount": 12.8, "cost": 0.01064614}, {"id": "69276056", "timestamp": 1536380443000, "datetime": "2018-09-08T04:20:43.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083274, "amount": 16.0, "cost": 0.01332384}, {"id": "69276355", "timestamp": 1536380920000, "datetime": "2018-09-08T04:28:40.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083171, "amount": 17.92, "cost": 0.01490424}, {"id": "69276483", "timestamp": 1536381211000, "datetime": "2018-09-08T04:33:31.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083171, "amount": 18.0, "cost": 0.01497078}, {"id": "69276517", "timestamp": 1536381362000, "datetime": "2018-09-08T04:36:02.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083144, "amount": 14.8, "cost": 0.01230531}, {"id": "69276746", "timestamp": 1536381794000, "datetime": "2018-09-08T04:43:14.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083211, "amount": 15.53, "cost": 0.01292266}, {"id": "69276891", "timestamp": 1536381952000, "datetime": "2018-09-08T04:45:52.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00082863, "amount": 15.1, "cost": 0.01251231}, {"id": "69277147", "timestamp": 1536382328000, "datetime": "2018-09-08T04:52:08.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083029, "amount": 14.33, "cost": 0.01189805}, {"id": "69277238", "timestamp": 1536382497000, "datetime": "2018-09-08T04:54:57.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00082862, "amount": 16.3, "cost": 0.0135065}, {"id": "69277499", "timestamp": 1536382973000, "datetime": "2018-09-08T05:02:53.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083109, "amount": 15.0, "cost": 0.01246635}, {"id": "69277596", "timestamp": 1536383192000, "datetime": "2018-09-08T05:06:32.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083027, "amount": 13.83, "cost": 0.01148263}, {"id": "69277830", "timestamp": 1536383557000, "datetime": "2018-09-08T05:12:37.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00082922, "amount": 12.0, "cost": 0.00995064}, {"id": "69277889", "timestamp": 1536383706000, "datetime": "2018-09-08T05:15:06.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00082899, "amount": 17.03, "cost": 0.01411769}, {"id": "69278299", "timestamp": 1536384361000, "datetime": "2018-09-08T05:26:01.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00082899, "amount": 13.67, "cost": 0.01133229}, {"id": "69278405", "timestamp": 1536384477000, "datetime": "2018-09-08T05:27:57.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083095, "amount": 17.175, "cost": 0.01427156}, {"id": "69278596", "timestamp": 1536384965000, "datetime": "2018-09-08T05:36:05.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083045, "amount": 15.7, "cost": 0.01303806}, {"id": "69278699", "timestamp": 1536385036000, "datetime": "2018-09-08T05:37:16.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083333, "amount": 0.50443819, "cost": 0.00042036}, {"id": "69278815", "timestamp": 1536385168000, "datetime": "2018-09-08T05:39:28.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083064, "amount": 14.0, "cost": 0.01162896}, {"id": "69278972", "timestamp": 1536385476000, "datetime": "2018-09-08T05:44:36.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.0008328, "amount": 16.9, "cost": 0.01407432}, {"id": "69279758", "timestamp": 1536385735000, "datetime": "2018-09-08T05:48:55.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083089, "amount": 13.98, "cost": 0.01161584}, {"id": "69280482", "timestamp": 1536386100000, "datetime": "2018-09-08T05:55:00.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083179, "amount": 12.0, "cost": 0.00998148}, {"id": "69280790", "timestamp": 1536386454000, "datetime": "2018-09-08T06:00:54.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083333, "amount": 0.09110981, "cost": 7.592e-05}, {"id": "69280842", "timestamp": 1536386517000, "datetime": "2018-09-08T06:01:57.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00082996, "amount": 12.6, "cost": 0.01045749}, {"id": "69281258", "timestamp": 1536386883000, "datetime": "2018-09-08T06:08:03.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083045, "amount": 14.0, "cost": 0.0116263}, {"id": "69281328", "timestamp": 1536387055000, "datetime": "2018-09-08T06:10:55.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00082859, "amount": 12.821, "cost": 0.01062335}, {"id": "69281503", "timestamp": 1536387419000, "datetime": "2018-09-08T06:16:59.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00082927, "amount": 18.0, "cost": 0.01492686}, {"id": "69281557", "timestamp": 1536387525000, "datetime": "2018-09-08T06:18:45.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083068, "amount": 15.416, "cost": 0.01280576}, {"id": "69281762", "timestamp": 1536387920000, "datetime": "2018-09-08T06:25:20.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083119, "amount": 15.3, "cost": 0.0127172}, {"id": "69281843", "timestamp": 1536388005000, "datetime": "2018-09-08T06:26:45.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083721, "amount": 3.50207122, "cost": 0.00293196}, {"id": "69281842", "timestamp": 1536388005000, "datetime": "2018-09-08T06:26:45.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083334, "amount": 0.01, "cost": 8.33e-06}, {"id": "69281853", "timestamp": 1536388017000, "datetime": "2018-09-08T06:26:57.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.0008373, "amount": 4.24251688, "cost": 0.00355225}, {"id": "69281877", "timestamp": 1536388034000, "datetime": "2018-09-08T06:27:14.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00084042, "amount": 13.694, "cost": 0.01150871}, {"id": "69281884", "timestamp": 1536388049000, "datetime": "2018-09-08T06:27:29.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.0008375, "amount": 4.19548921, "cost": 0.00351372}, {"id": "69281914", "timestamp": 1536388082000, "datetime": "2018-09-08T06:28:02.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.0008375, "amount": 3.35434027, "cost": 0.00280925}, {"id": "69282277", "timestamp": 1536388448000, "datetime": "2018-09-08T06:34:08.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.0008374, "amount": 18.0, "cost": 0.0150732}, {"id": "69282667", "timestamp": 1536388580000, "datetime": "2018-09-08T06:36:20.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083746, "amount": 0.13189138, "cost": 0.00011045}, {"id": "69282692", "timestamp": 1536388620000, "datetime": "2018-09-08T06:37:00.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083803, "amount": 17.27, "cost": 0.01447277}, {"id": "69282700", "timestamp": 1536388642000, "datetime": "2018-09-08T06:37:22.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.0008387, "amount": 4.56781035, "cost": 0.00383102}, {"id": "69282747", "timestamp": 1536388681000, "datetime": "2018-09-08T06:38:01.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.000878, "amount": 0.12461541, "cost": 0.00010941}, {"id": "69282746", "timestamp": 1536388681000, "datetime": "2018-09-08T06:38:01.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.000873, "amount": 1.0, "cost": 0.000873}, {"id": "69282745", "timestamp": 1536388681000, "datetime": "2018-09-08T06:38:01.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00085512, "amount": 0.56392438, "cost": 0.00048222}, {"id": "69282744", "timestamp": 1536388681000, "datetime": "2018-09-08T06:38:01.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00084937, "amount": 0.50342932, "cost": 0.00042759}, {"id": "69282743", "timestamp": 1536388681000, "datetime": "2018-09-08T06:38:01.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00084111, "amount": 0.3009623, "cost": 0.00025314}, {"id": "69282742", "timestamp": 1536388681000, "datetime": "2018-09-08T06:38:01.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083853, "amount": 4.24882257, "cost": 0.00356276}, {"id": "69282767", "timestamp": 1536388704000, "datetime": "2018-09-08T06:38:24.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083844, "amount": 3.85085672, "cost": 0.00322871}, {"id": "69282783", "timestamp": 1536388726000, "datetime": "2018-09-08T06:38:46.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083844, "amount": 1.97763704, "cost": 0.00165812}, {"id": "69283174", "timestamp": 1536389019000, "datetime": "2018-09-08T06:43:39.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083794, "amount": 14.595, "cost": 0.01222973}, {"id": "69283256", "timestamp": 1536389164000, "datetime": "2018-09-08T06:46:04.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083747, "amount": 1.32102515, "cost": 0.00110631}, {"id": "69283352", "timestamp": 1536389303000, "datetime": "2018-09-08T06:48:23.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083384, "amount": 13.26, "cost": 0.01105671}, {"id": "69283684", "timestamp": 1536389566000, "datetime": "2018-09-08T06:52:46.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083633, "amount": 13.386, "cost": 0.01119511}, {"id": "69283871", "timestamp": 1536389845000, "datetime": "2018-09-08T06:57:25.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083237, "amount": 12.0, "cost": 0.00998844}, {"id": "69284153", "timestamp": 1536389940000, "datetime": "2018-09-08T06:59:00.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083164, "amount": 15.99, "cost": 0.01329792}, {"id": "69284299", "timestamp": 1536390011000, "datetime": "2018-09-08T07:00:11.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083815, "amount": 0.06602601, "cost": 5.533e-05}, {"id": "69284479", "timestamp": 1536390179000, "datetime": "2018-09-08T07:02:59.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083457, "amount": 15.0, "cost": 0.01251855}, {"id": "69284709", "timestamp": 1536390722000, "datetime": "2018-09-08T07:12:02.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083587, "amount": 12.62, "cost": 0.01054867}, {"id": "69284844", "timestamp": 1536390878000, "datetime": "2018-09-08T07:14:38.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083445, "amount": 12.7, "cost": 0.01059751}, {"id": "69284922", "timestamp": 1536391062000, "datetime": "2018-09-08T07:17:42.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083694, "amount": 17.3, "cost": 0.01447906}, {"id": "69287311", "timestamp": 1536392953000, "datetime": "2018-09-08T07:49:13.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083448, "amount": 14.9, "cost": 0.01243375}, {"id": "69287664", "timestamp": 1536393177000, "datetime": "2018-09-08T07:52:57.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083636, "amount": 14.9, "cost": 0.01246176}, {"id": "69288137", "timestamp": 1536393623000, "datetime": "2018-09-08T08:00:23.000Z", 
"symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00088, "amount": 0.56718181, "cost": 0.00049911}, {"id": "69288136", "timestamp": 1536393623000, "datetime": "2018-09-08T08:00:23.000Z", "symbol": "EOS/BTC", 
"order": null, "type": null, "side": "buy", "price": 0.00087998, "amount": 0.11521244, "cost": 0.00010138}, {"id": "69288135", "timestamp": 1536393623000, "datetime": "2018-09-08T08:00:23.000Z", "symbol": "EOS/BTC", "order": null, "type": 
null, "side": "buy", "price": 0.0008798, "amount": 0.8098209, "cost": 0.00071248}, {"id": "69288134", "timestamp": 1536393623000, "datetime": "2018-09-08T08:00:23.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", 
"price": 0.0008797, "amount": 0.2368523, "cost": 0.00020835}, {"id": "69288133", "timestamp": 1536393623000, "datetime": "2018-09-08T08:00:23.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.0008797, 
"amount": 0.11990407, "cost": 0.00010547}, {"id": "69288132", "timestamp": 1536393623000, "datetime": "2018-09-08T08:00:23.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.000878, "amount": 4.08875046, 
"cost": 0.00358992}, {"id": "69288131", "timestamp": 1536393623000, "datetime": "2018-09-08T08:00:23.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00087799, "amount": 1.3183831, "cost": 0.00115752}, 
{"id": "69288130", "timestamp": 1536393623000, "datetime": "2018-09-08T08:00:23.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083849, "amount": 0.01052655, "cost": 8.82e-06}, {"id": "69288129", 
"timestamp": 1536393623000, "datetime": "2018-09-08T08:00:23.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083845, "amount": 2.73336893, "cost": 0.00229179}, {"id": "69288454", "timestamp": 
1536393987000, "datetime": "2018-09-08T08:06:27.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083631, "amount": 16.27, "cost": 0.01360676}, {"id": "69288572", "timestamp": 1536394083000, "datetime": "2018-09-08T08:08:03.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083829, "amount": 0.59422157, "cost": 0.00049812}, {"id": "69288691", "timestamp": 1536394144000, "datetime": 
"2018-09-08T08:09:04.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083389, "amount": 0.40597501, "cost": 0.00033853}, {"id": "69288690", "timestamp": 1536394144000, "datetime": 
"2018-09-08T08:09:04.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.0008339, "amount": 1.14929328, "cost": 0.00095839}, {"id": "69288689", "timestamp": 1536394144000, "datetime": 
"2018-09-08T08:09:04.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.0008339, "amount": 0.23602683, "cost": 0.00019682}, {"id": "69288688", "timestamp": 1536394144000, "datetime": 
"2018-09-08T08:09:04.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.000834, "amount": 1.0459, "cost": 0.00087228}, {"id": "69288687", "timestamp": 1536394144000, "datetime": "2018-09-08T08:09:04.000Z", 
"symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.000834, "amount": 0.10339328, "cost": 8.622e-05}, {"id": "69288686", "timestamp": 1536394144000, "datetime": "2018-09-08T08:09:04.000Z", "symbol": "EOS/BTC", 
"order": null, "type": null, "side": "buy", "price": 0.00083829, "amount": 2.94648135, "cost": 0.00247}, {"id": "69288954", "timestamp": 1536394430000, "datetime": "2018-09-08T08:13:50.000Z", "symbol": "EOS/BTC", "order": null, "type": null, 
"side": "sell", "price": 0.00083576, "amount": 15.7, "cost": 0.01312143}, {"id": "69289166", "timestamp": 1536394581000, "datetime": "2018-09-08T08:16:21.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 
0.00083731, "amount": 15.62, "cost": 0.01307878}, {"id": "69289350", "timestamp": 1536394876000, "datetime": "2018-09-08T08:21:16.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00084196, "amount": 13.5, 
"cost": 0.01136646}, {"id": "69290071", "timestamp": 1536395276000, "datetime": "2018-09-08T08:27:56.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00084155, "amount": 13.4, "cost": 0.01127677}, {"id": 
"69290218", "timestamp": 1536395452000, "datetime": "2018-09-08T08:30:52.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00084086, "amount": 13.8, "cost": 0.01160386}, {"id": "69290370", "timestamp": 
1536395604000, "datetime": "2018-09-08T08:33:24.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00084267, "amount": 17.3, "cost": 0.01457819}, {"id": "69290598", "timestamp": 1536395810000, "datetime": 
"2018-09-08T08:36:50.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00084, "amount": 1.0, "cost": 0.00084}, {"id": "69290846", "timestamp": 1536395992000, "datetime": "2018-09-08T08:39:52.000Z", "symbol": 
"EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.000844, "amount": 17.3, "cost": 0.0146012}, {"id": "69291271", "timestamp": 1536396298000, "datetime": "2018-09-08T08:44:58.000Z", "symbol": "EOS/BTC", "order": null, "type": 
null, "side": "buy", "price": 0.00084504, "amount": 0.04865372, "cost": 4.111e-05}, {"id": "69291286", "timestamp": 1536396317000, "datetime": "2018-09-08T08:45:17.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", 
"price": 0.00084533, "amount": 2.46943279, "cost": 0.00208748}, {"id": "69291291", "timestamp": 1536396326000, "datetime": "2018-09-08T08:45:26.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00085326, 
"amount": 17.0, "cost": 0.01450542}, {"id": "69291363", "timestamp": 1536396449000, "datetime": "2018-09-08T08:47:29.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00084, "amount": 14.99999999, "cost": 0.01259999}, {"id": "69291372", "timestamp": 1536396458000, "datetime": "2018-09-08T08:47:38.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083976, "amount": 14.667, "cost": 0.01231675}, {"id": "69291585", "timestamp": 1536396807000, "datetime": "2018-09-08T08:53:27.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00084088, "amount": 12.0, "cost": 0.01009056}, {"id": "69291652", "timestamp": 1536396882000, "datetime": "2018-09-08T08:54:42.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.00083737, "amount": 13.0, "cost": 0.01088581}, {"id": "69291945", "timestamp": 1536397161000, "datetime": "2018-09-08T08:59:21.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00084179, "amount": 17.9, "cost": 0.01506804}, {"id": "69292665", "timestamp": 1536397598000, "datetime": "2018-09-08T09:06:38.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "sell", "price": 0.0008339, "amount": 0.05827097, "cost": 4.859e-05}, {"id": "69292678", "timestamp": 1536397600000, "datetime": "2018-09-08T09:06:40.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.00083388, "amount": 14.25, "cost": 0.01188279}, {"id": "69292682", "timestamp": 1536397601000, "datetime": "2018-09-08T09:06:41.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.0008339, "amount": 4.95364112, "cost": 0.00413084}, {"id": "69293112", "timestamp": 1536397698000, "datetime": "2018-09-08T09:08:18.000Z", "symbol": "EOS/BTC", "order": null, "type": null, "side": "buy", "price": 0.0008399, "amount": 14.8, "cost": 0.01243052}]}'

select GETUTCDATE() insert_date, timestamp, ts, e.exchange, e.pair, cast(cast(price as real) as decimal(38,10)) price, cast(cast(amount as real) as decimal(38,10)) amount, type, side, coalesce(id1,id2,id3) id
	from  OPENJSON(@json) 
		with (
			exchange varchar(50) '$.exchange',
			pair varchar(10) '$.pair'
		) e
	cross apply OPENJSON(@json,'$.histories')
	with (
		[timestamp] numeric(38, 0) '$.timestamp',
		-- [timestamp] numeric(38, 0) '$.date',
		[type] varchar(24) '$.type',
		--quantity decimal(38, 12) '$.quantity',
		price varchar(32) '$.price',
		amount varchar(32) '$.amount',
		side varchar(5) '$.side',
		[id1] bigint '$.trade_id',
		[id2] bigint '$.id',
		[id3] bigint '$.tid'
	) j
	cross apply (SELECT DATEADD(second, [timestamp]/1000, CAST('1970-01-01 00:00:00' AS datetime)) ts) d